<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 3 Operaciones de datos de atributos | Geocomputación con R</title>
<meta name="author" content="Robin Lovelace, Jakub Nowosad, Jannes Muenchow">
<meta name="description" content="Prerrequisitos Este capítulo requiere que se instalen y adjunten los siguientes paquetes: library(sf)   # paquete de datos vectoriales introducido en el capítulo 2 library(terra)  # paquete de...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 3 Operaciones de datos de atributos | Geocomputación con R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://geocompr.github.io/es/attr.html">
<meta property="og:image" content="https://geocompr.github.io/es/images/cover.png">
<meta property="og:description" content="Prerrequisitos Este capítulo requiere que se instalen y adjunten los siguientes paquetes: library(sf)   # paquete de datos vectoriales introducido en el capítulo 2 library(terra)  # paquete de...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 3 Operaciones de datos de atributos | Geocomputación con R">
<meta name="twitter:description" content="Prerrequisitos Este capítulo requiere que se instalen y adjunten los siguientes paquetes: library(sf)   # paquete de datos vectoriales introducido en el capítulo 2 library(terra)  # paquete de...">
<meta name="twitter:image" content="https://geocompr.github.io/es/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/_Lato-0.4.0/font.css" rel="stylesheet">
<link href="libs/_Roboto%20Mono-0.4.0/font.css" rel="stylesheet">
<link href="libs/_Montserrat-0.4.0/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-99618359-1', 'auto');
      ga('send', 'pageview');

    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Geocomputación con R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Bienvenido</a></li>
<li><a class="" href="pr%C3%B3logo-1a-edici%C3%B3n.html">Prólogo (1a Edición)</a></li>
<li><a class="" href="prefacio.html">Prefacio</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Introducción</a></li>
<li class="book-part">Fundamentos</li>
<li><a class="" href="spatial-class.html"><span class="header-section-number">2</span> Datos geográficos en R</a></li>
<li><a class="active" href="attr.html"><span class="header-section-number">3</span> Operaciones de datos de atributos</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/geocompr/es">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="attr" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> Operaciones de datos de atributos<a class="anchor" aria-label="anchor" href="#attr"><i class="fas fa-link"></i></a>
</h1>
<div id="prerrequisitos-1" class="section level2 unnumbered">
<h2>Prerrequisitos<a class="anchor" aria-label="anchor" href="#prerrequisitos-1"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Este capítulo requiere que se instalen y adjunten los siguientes paquetes:</li>
</ul>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>      <span class="co"># paquete de datos vectoriales introducido en el capítulo 2</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/">terra</a></span><span class="op">)</span>   <span class="co"># paquete de datos raster introducido en el capítulo 2</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>   <span class="co"># paquete tidyverse para la manipulación de marcos de datos</span></code></pre></div>
<ul>
<li>También depende de <strong>spData</strong>, que carga los conjuntos de datos utilizados en los ejemplos de código de este capítulo:</li>
</ul>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://nowosad.github.io/spData/">spData</a></span><span class="op">)</span>  <span class="co"># paquete de datos espaciales introducido en el capítulo 2</span></code></pre></div>
</div>
<div id="introducción" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Introducción<a class="anchor" aria-label="anchor" href="#introducci%C3%B3n"><i class="fas fa-link"></i></a>
</h2>
<p>Los datos de atributos son la información no espacial asociada a los datos geográficos (geométricos).
Un ejemplo sencillo es el de una parada de autobús: su posición suele estar representada por coordenadas de latitud y longitud (datos geométricos), además de su nombre.
La parada <a href="https://www.openstreetmap.org/relation/6610626">Elephant &amp; Castle / New Kent Road</a> de Londres, por ejemplo, tiene unas coordenadas de -0,098 grados de longitud y 51,495 grados de latitud que pueden representarse como <code>POINT (-0,098 51,495)</code> en la representación <code>sfc</code> descrita en el capítulo <a href="spatial-class.html#spatial-class">2</a>.
Los atributos, como el nombre <em>atributo</em> de la función POINT (por utilizar la terminología de Simple Features) son el tema de este capítulo.</p>
<p>Otro ejemplo es el valor de elevación (atributo) de una celda específica de la cuadrícula en los datos raster.
A diferencia del modelo de datos vectoriales, el modelo de datos raster almacena la coordenada de la celda de la cuadrícula de forma indirecta, lo cual significa que la distinción entre atributo e información espacial es menos clara.
Para ilustrar este punto, piensa en un píxel en la 3ª fila y la 4ª columna de una matriz raster.</p>
<p>Su ubicación espacial está definida por su índice en la matriz: se mueve desde el origen cuatro celdas en la dirección x (normalmente este y derecha en los mapas) y tres celdas en la dirección y (normalmente sur y abajo).
La <em>resolución</em> del raster define la distancia para cada paso en x e y que se especifica en un <em>cabezal</em>.
La cabecera es un componente vital de los conjuntos de datos raster que especifica cómo se relacionan los píxeles con las coordenadas geográficas (véase también el capítulo <a href="#spatial-operations"><strong>??</strong></a>).</p>
<p>Esto muestra cómo manipular objetos geográficos basados en atributos como los nombres de las paradas de autobús en un conjunto de datos vectoriales y las elevaciones de los píxeles en un conjunto de datos rasterizados.
En el caso de los datos vectoriales, esto implica técnicas como crear subconjuntos y o agregaciones (véanse las secciones @ref(subconjunto de atributos vectoriales) y @ref(agregación de atributos vectoriales)).</p>
<p>Las secciones <a href="#vector-attribute-joining"><strong>??</strong></a> y <a href="attr.html#vec-attr-creation">3.2.5</a> demuestran cómo unir datos en objetos de características simples utilizando un ID compartido y cómo crear nuevas variables, respectivamente.
Cada una de estas operaciones tiene un equivalente espacial:
el operador <code>[</code> en R básico, por ejemplo, funciona igualmente para subconjuntar objetos basados en su atributo y objetos espaciales; también se pueden unir atributos en dos conjuntos de datos geográficos utilizando uniones espaciales.
Esto es una buena noticia: las habilidades desarrolladas en este capítulo son transferibles.
El capítulo <a href="#spatial-operations"><strong>??</strong></a> extiende los métodos presentados aquí al mundo espacial.</p>
<p>Después de una inmersión profunda en varios tipos de operaciones de atributos <em>vectoriales</em> en la siguiente sección, las operaciones de datos de atributos <em>raster</em> se cubren en la Sección (manipulando-objetos-raster), que demuestra cómo crear capas raster que contienen atributos continuos y categóricos y cómo extraer valores de celdas de una o más capas (subconjunto raster).
La sección <a href="attr.html#summarizing-raster-objects">3.3.2</a> proporciona una visión general de las operaciones ráster “globales” que pueden utilizarse para resumir conjuntos de datos raster completos.</p>
</div>
<div id="manipulación-de-atributos-vectoriales" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> Manipulación de atributos vectoriales<a class="anchor" aria-label="anchor" href="#manipulaci%C3%B3n-de-atributos-vectoriales"><i class="fas fa-link"></i></a>
</h2>
<p>Los conjuntos de datos vectoriales geográficos están bien soportados en R gracias a la clase <code>sf</code>, que extiende la clase <code>data.frame</code> de R.
Al igual que los marcos de datos, los objetos <code>sf</code> tienen una columna por variable de atributo (como ‘nombre’) y una fila por observación o <em>característica</em> (por ejemplo, por estación de autobuses).
Los objetos <code>sf</code> se diferencian de los marcos de datos básicos porque tienen una columna de <code>geometría</code> de la clase <code>sfc</code> que puede contener una serie de entidades geográficas (uno o ‘múltiples’ puntos, líneas y polígonos) por fila.
Esto se describió en el capítulo <a href="spatial-class.html#spatial-class">2</a>, donde se demostró cómo <em>los métodos genéricos</em> como <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code> y <code><a href="https://rdrr.io/pkg/terra/man/summary.html">summary()</a></code> funcionan con los objetos <code>sf</code>.
<strong>sf</strong> también proporciona genéricos que permiten que los objetos <code>sf</code> se comporten como marcos de datos normales, como se muestra al imprimir los métodos de la clase:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/methods.html">methods</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span> <span class="co"># métodos para objetos sf, se muestran los 12 primeros</span></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#&gt;  [1] aggregate             cbind                 coerce               </span>
<span class="co">#&gt;  [4] initialize            merge                 plot                 </span>
<span class="co">#&gt;  [7] print                 rbind                 [                    </span>
<span class="co">#&gt; [10] [[&lt;-                  $&lt;-                   show                 </span></code></pre></div>
<p>Muchos de ellos (<code><a href="https://r-spatial.github.io/sf/reference/aggregate.sf.html">aggregate()</a></code>, <code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code>, <code><a href="https://rdrr.io/pkg/terra/man/merge.html">merge()</a></code>, <code><a href="https://rdrr.io/r/base/cbind.html">rbind()</a></code> y <code>[</code>) sirven para manejar marcos de datos.
Por ejemplo, <code><a href="https://rdrr.io/r/base/cbind.html">rbind()</a></code> une dos marcos de datos, uno “sobre” el otro.
<code>$&lt;-</code> crea nuevas columnas.
Una característica clave de los objetos <code>sf</code> es que almacenan datos espaciales y no espaciales de la misma manera, como columnas en un <code>data.frame</code>.</p>

<div class="rmdnote">
<p>La columna de geometría de los objetos <code>sf</code> suele llamarse <code>geometría</code> o <code>geom</code>, pero puede utilizarse cualquier nombre.
El siguiente comando, por ejemplo, crea una columna de geometría llamada <code>g</code>:</p>
<p><code>st_sf(data.frame(n = world$name_long), g = world$geom)</code></p>
Esto permite que las geometrías importadas de las bases de datos espaciales tengan varios nombres, como <code>wkb_geometry</code> y <code>the_geom</code>.
</div>
<p>Los objetos <code>sf</code> también pueden extender las clases <code>tidyverse</code> para marcos de datos, <code>tibble</code> y <code>tbl</code>.
.
Por lo tanto, <strong>sf</strong> permite dar rienda suelta a toda la potencia de las capacidades de análisis de datos de R en los datos geográficos, tanto si se utiliza la base de R como las funciones de tidyverse para el análisis de datos.

(Ver <a href="https://github.com/Rdatatable/data.table/issues/2273"><code>Rdatatable/data.table#2273</code></a> para ver la compatibilidad entre los objetos <code>sf</code> y el paquete <code>data.table</code>).
Antes de utilizar estas capacidades, merece la pena repasar cómo descubrir las propiedades básicas de los objetos de datos vectoriales.
Empecemos por utilizar las funciones básicas de R para conocer el conjunto de datos <code>world</code> del paquete <strong>spData</strong>:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">world</span><span class="op">)</span> <span class="co"># es un objeto sf y un marco de datos (ordenado)</span>
<span class="co">#&gt; [1] "sf"         "tbl_df"     "tbl"        "data.frame"</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">dim</a></span><span class="op">(</span><span class="va">world</span><span class="op">)</span>   <span class="co"># es un objeto bidimensional, con 177 filas y 11 columnas</span>
<span class="co">#&gt; [1] 177  11</span></code></pre></div>
<p><code>world</code> contiene diez columnas no geográficas (y una columna que contiene una lista de geometrías) con casi 200 filas que representan los países del mundo.
La función <code><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry()</a></code> mantiene sólo los datos de los atributos de un objeto <code>sf</code>, es decir, elimina su geometría:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world_df</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">world</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">world_df</span><span class="op">)</span>
<span class="co">#&gt; [1] "tbl_df"     "tbl"        "data.frame"</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">ncol</a></span><span class="op">(</span><span class="va">world_df</span><span class="op">)</span>
<span class="co">#&gt; [1] 10</span></code></pre></div>
<p>La eliminación de la columna de geometría antes de trabajar con los datos de atributos puede ser útil; los procesos de manipulación de datos pueden ejecutarse más rápido cuando trabajan sólo con los datos de atributos y las columnas de geometría no siempre son necesarias.
En la mayoría de los casos, sin embargo, tiene sentido mantener la columna de geometría, lo que explica que la columna sea “pegajosa” (permanece después de la mayoría de las operaciones de atributos a menos que se elimine específicamente).
Las operaciones de datos no espaciales sobre objetos <code>sf</code> sólo cambian la geometría de un objeto cuando es apropiado (por ejemplo, disolviendo los bordes entre polígonos adyacentes tras una agregación).
Convertirse en un experto en la manipulación de datos de atributos geográficos significa convertirse en un experto en la manipulación de marcos de datos.</p>
<p>Para muchas aplicaciones, el paquete tidyverse  <strong>dplyr</strong> ofrece un enfoque eficaz para trabajar con marcos de datos.
La compatibilidad con Tidyverse es una ventaja de <strong>sf</strong> frente a su predecesor <strong>sp</strong>, pero hay que evitar algunos inconvenientes (véase la viñeta complementaria <code>tidyverse-pitfalls</code> en <a href="https://geocompr.github.io/geocompkg/articles/tidyverse-pitfalls.html">geocompr.github.io</a> para más detalles).</p>
<div id="subconjuntos-de-atributos-vectoriales" class="section level3" number="3.2.1">
<h3>
<span class="header-section-number">3.2.1</span> Subconjuntos de atributos vectoriales<a class="anchor" aria-label="anchor" href="#subconjuntos-de-atributos-vectoriales"><i class="fas fa-link"></i></a>
</h3>
<p>Los métodos de subconjunto de R base incluyen el operador <code>[</code> y la función <code><a href="https://rdrr.io/pkg/terra/man/subset.html">subset()</a></code>.
Las funciones clave para manejar y crear subconjuntos de <strong>dplyr</strong> son <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> y <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> para crear subconjuntos de filas, y <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> para crear subconjuntos de columnas.
Ambos planteamientos conservan los componentes espaciales de los datos de atributos en los objetos <code>sf</code>, mientras que si se utiliza el operador <code>$</code> o la función <strong>dplyr</strong> <code><a href="https://dplyr.tidyverse.org/reference/pull.html">pull()</a></code> para devolver una única columna de atributos como vector se perderán los datos de atributos, tal y como veremos.

Esta sección se centra en el subconjunto de marcos de datos <code>sf</code>; para más detalles sobre el subconjunto de vectores y marcos de datos no geográficos recomendamos leer la sección <a href="https://cran.r-project.org/doc/manuals/r-release/R-intro.html#Index-vectors">2.7</a> de An Introduction to R <span class="citation">(<a href="#ref-rcoreteam_introduction_2021" role="doc-biblioref"><strong>rcoreteam_introduction_2021?</strong></a>)</span> y el Capítulo <a href="https://adv-r.hadley.nz/subsetting.html">4</a> de Advanced R Programming <span class="citation">(<a href="#ref-wickham_advanced_2019" role="doc-biblioref"><strong>wickham_advanced_2019?</strong></a>)</span>, respectivamente.</p>
<p>El operador <code>[</code> puede dividir tanto filas como columnas.
Los índices colocados dentro de los corchetes situados directamente después del nombre de un objeto de marco de datos especifican los elementos que se quieren conservar.
El comando <code>object[i, j]</code> significa ’devolver las filas representadas por <code>i</code> y las columnas representadas por <code>j</code>, donde <code>i</code> y <code>j</code> suelen contener enteros o <code>TRUE</code> y <code>FALSE</code> (los índices también pueden ser caracteres, indicando los nombres de las filas o las columnas).
<code>object[5, 1:3]</code>, por ejemplo, significa <code>devolver datos que contengan la 5ª fila y las columnas 1 a 3</code>: el resultado debería ser un marco de datos con sólo 1 fila y 3 columnas, y una cuarta columna de geometría si es un objeto <code>sf</code>.
Si se deja <code>i</code> o <code>j</code> vacía se devuelven todas las filas o columnas, por lo que <code>world[1:5, ]</code> devuelve las cinco primeras filas y las 11 columnas que componen el marco de datos.
Los ejemplos que hay a continuación demuestran la creación de subconjunto con R base.
Adivina el número de filas y columnas de los marcos de datos <code>sf</code> devueltos por cada comando y comprueba los resultados en tu propio ordenador (consulta el final del capítulo para ver más ejercicios):</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="op">]</span>    <span class="co"># Subconjunto de las filas 1 a 6 </span>
<span class="va">world</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>    <span class="co"># Subconjunto de las columnas 1 a 3</span>
<span class="va">world</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="co"># Subconjunto de las filas 1 a 6 y las columnas 1 a 3</span>
<span class="va">world</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"name_long"</span>, <span class="st">"pop"</span><span class="op">)</span><span class="op">]</span> <span class="co"># Columnas por nombre</span>
<span class="va">world</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="cn">T</span>, <span class="cn">T</span>, <span class="cn">F</span>, <span class="cn">F</span>, <span class="cn">F</span>, <span class="cn">F</span>, <span class="cn">F</span>, <span class="cn">T</span>, <span class="cn">T</span>, <span class="cn">F</span>, <span class="cn">F</span><span class="op">)</span><span class="op">]</span> <span class="co"># Selección de columnas por índices lógicos</span>
<span class="va">world</span><span class="op">[</span>, <span class="fl">888</span><span class="op">]</span> <span class="co"># Índice representando una columna no existenete</span></code></pre></div>
<p>Una demostración de la utilidad de utilizar vectores <code>lógicos</code> para el subconjunto se muestra en el fragmento de código siguiente.
Esto crea un nuevo objeto, <code>small_countries</code>, que contiene las naciones cuya superficie es inferior a 10.000 km<sup>2</sup>:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">i_small</span> <span class="op">=</span> <span class="va">world</span><span class="op">$</span><span class="va">area_km2</span> <span class="op">&lt;</span> <span class="fl">10000</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html">summary</a></span><span class="op">(</span><span class="va">i_small</span><span class="op">)</span> <span class="co"># un vector lógico</span>
<span class="co">#&gt;    Mode   FALSE    TRUE </span>
<span class="co">#&gt; logical     170       7</span>
<span class="va">small_countries</span> <span class="op">=</span> <span class="va">world</span><span class="op">[</span><span class="va">i_small</span>, <span class="op">]</span></code></pre></div>
<p>El objeto <code>i_small</code> (abreviatura de “índice” que representa a los países pequeños) es un vector lógico que se puede utilizar para agrupar los siete países más pequeños del <code>mundo</code> por su superficie.
Un comando más conciso, que omita el objeto intermediario (<code>i_small</code>), genera el mismo resultado:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">small_countries</span> <span class="op">=</span> <span class="va">world</span><span class="op">[</span><span class="va">world</span><span class="op">$</span><span class="va">area_km2</span> <span class="op">&lt;</span> <span class="fl">10000</span>, <span class="op">]</span></code></pre></div>
<p>La función base de R <code><a href="https://rdrr.io/pkg/terra/man/subset.html">subset()</a></code> proporciona otra forma de conseguir el mismo resultado:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">small_countries</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html">subset</a></span><span class="op">(</span><span class="va">world</span>, <span class="va">area_km2</span> <span class="op">&lt;</span> <span class="fl">10000</span><span class="op">)</span></code></pre></div>
<p>Las funciones de R base son maduras, estables y ampliamente utilizadas, lo que las convierte en una opción sólida, especialmente en contextos en los que la reproducibilidad y la fiabilidad son fundamentales.
Las funciones de <strong>dplyr</strong> permiten flujos de trabajo “ordenados” que algunas personas (incluidos los autores de este libro) encuentran intuitivos y productivos para el análisis interactivo de datos, especialmente cuando se combinan con editores de código como RStudio que permiten <a href="https://support.rstudio.com/hc/en-us/articles/205273297-Code-Completion-in-the-RStudio-IDE">autocompletar</a> los nombres de las columnas.
A continuación se muestran las funciones clave para el subconjunto de marcos de datos (incluidos los marcos de datos <code>sf</code>) con las funciones <strong>dplyr</strong>.
<!-- La frase que sigue parece no ser cierta según el punto de referencia que se indica a continuación. -->
<!-- `dplyr` también es más rápido que R base para algunas operaciones, debido a su backend C++\index{C++}. -->
<!-- ¿Algo sobre dbplyr? Nunca he visto a nadie usarlo regularmente para datos espaciales 'en el campo' así que omitiremos la parte de la integración con dbs por ahora (RL 2021-10) -->
<!-- Las principales funciones de **dplyr** para crear subgrupos son `select()`, `slice()`, `filter()` y `pull()`. --></p>
<p><code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> selecciona las columnas por nombre o posición.
Por ejemplo, podrías seleccionar sólo dos columnas, <code>name_long</code> y <code>pop</code>, con el siguiente comando:</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world1</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">world</span>, <span class="va">name_long</span>, <span class="va">pop</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/names.html">names</a></span><span class="op">(</span><span class="va">world1</span><span class="op">)</span>
<span class="co">#&gt; [1] "name_long" "pop"       "geom"</span></code></pre></div>
<p>Nota: al igual que con el comando equivalente en R base (<code>world[, c("name_long", "pop")]</code>), la columna <code>geom</code> permanece.
<code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> también permite seleccionar un rango de columnas con la ayuda del operador <code>:</code>:</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Selecciona todas las columnas entre name_long y pop (incluidas)</span>
<span class="va">world2</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">world</span>, <span class="va">name_long</span><span class="op">:</span><span class="va">pop</span><span class="op">)</span></code></pre></div>
<p>Puedes eliminar columnas específicas con el operador <code>-</code>:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Muestra todas las columnas excepto subregion y area_km2 </span>
<span class="va">world3</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">world</span>, <span class="op">-</span><span class="va">subregion</span>, <span class="op">-</span><span class="va">area_km2</span><span class="op">)</span></code></pre></div>
<p>Crear subconjuntos y renombrar columnas al mismo tiempo con la sintaxis <code>nuevo_nombre = antiguo_nombre</code>:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world4</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">world</span>, <span class="va">name_long</span>, population <span class="op">=</span> <span class="va">pop</span><span class="op">)</span></code></pre></div>
<p>Cabe destacar que el comando anterior es más conciso que el equivalente en R base, el cual requiere dos líneas de código:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world5</span> <span class="op">=</span> <span class="va">world</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"name_long"</span>, <span class="st">"pop"</span><span class="op">)</span><span class="op">]</span> <span class="co"># subagrupar las columnas por nombre</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/names.html">names</a></span><span class="op">(</span><span class="va">world5</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/names.html">names</a></span><span class="op">(</span><span class="va">world5</span><span class="op">)</span> <span class="op">==</span> <span class="st">"pop"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"population"</span> <span class="co"># renombrar la columna manualmente</span></code></pre></div>
<p><code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> también funciona con “funciones de ayuda” para operaciones más avanzadas, como <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains()</a></code>, <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code> y <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">num_range()</a></code> (véase la página de ayuda con <code><a href="https://dplyr.tidyverse.org/reference/select.html">?select</a></code> para más detalles).</p>
<p>La mayoría de los verbos de <strong>dplyr</strong> devuelven un marco de datos, pero se puede extraer una sola columna como vector con <code><a href="https://dplyr.tidyverse.org/reference/pull.html">pull()</a></code>.
<!-- Note: I have commented out the statement below because it is not true for `sf` objects, it's a bit confusing that the behaviour differs between data frames and `sf` objects. -->
<!-- The subsetting operator in base R (see `?[`), by contrast, tries to return objects in the lowest possible dimension. -->
<!-- This means selecting a single column returns a vector in base R as demonstrated in code chunk below which returns a numeric vector representing the population of countries in the `world`: -->
Puede obtener el mismo resultado en R base con los operadores de subconjunto de listas <code>$</code> y <code>[[</code>, los tres comandos siguientes devuelven el mismo vector numérico:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">world</span>, <span class="va">pop</span><span class="op">)</span>
<span class="va">world</span><span class="op">$</span><span class="va">pop</span>
<span class="va">world</span><span class="op">[[</span><span class="st">"pop"</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<!-- Commenting out the following because it's confusing and covered better in other places (RL, 2021-10) -->
<!-- To turn off this behavior, set the `drop` argument to `FALSE`,  -->
<p><code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> es el equivalente de fila de <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>.
El siguiente fragmento de código, por ejemplo, selecciona las filas 1 a 6:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="va">world</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></code></pre></div>
<p><code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> es el equivalente de <strong>dplyr</strong> a la función <code><a href="https://rdrr.io/pkg/terra/man/subset.html">subset()</a></code> de R base.
Mantiene sólo las filas que coinciden según los criterios dados, por ejemplo, sólo los países con un área por debajo de un determinado umbral, o con un promedio alto de esperanza de vida, como se muestra en los siguientes ejemplos:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world7</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">world</span> ,<span class="va">area_km2</span> <span class="op">&lt;</span> <span class="fl">10000</span><span class="op">)</span> <span class="co"># países con un área menor a 10.000km2</span>
<span class="va">world7</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">world</span>, <span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">82</span><span class="op">)</span>      <span class="co"># con una esperanza de vida superior a 82 años</span></code></pre></div>
<p>El conjunto estándar de operadores de comparación se puede utilizar en la función <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, como se ilustra en la Tabla <a href="attr.html#tab:operators">3.1</a>:</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:operators">TABLE 3.1: </span>Operadores de comparación que retornan Booleanos (TRUE/FALSE).</caption>
<thead><tr class="header">
<th align="left">Symbol</th>
<th align="left">Name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>==</code></td>
<td align="left">Igual a</td>
</tr>
<tr class="even">
<td align="left"><code>!=</code></td>
<td align="left">Distinto a</td>
</tr>
<tr class="odd">
<td align="left">
<code>&gt;</code>, <code>&lt;</code>
</td>
<td align="left">Mayor/menor que</td>
</tr>
<tr class="even">
<td align="left">
<code>&gt;=</code>, <code>&lt;=</code>
</td>
<td align="left">Mayor/menor que o igual</td>
</tr>
<tr class="odd">
<td align="left">
<code>&amp;</code>, <code>|</code>, <code>!</code>
</td>
<td align="left">Operadores lógicos: Y, O, No (And, Or, Not)</td>
</tr>
</tbody>
</table></div>
</div>
<div id="encadenamiento-de-comandos-con-el-operador-pipe" class="section level3" number="3.2.2">
<h3>
<span class="header-section-number">3.2.2</span> Encadenamiento de comandos con el operador pipe<a class="anchor" aria-label="anchor" href="#encadenamiento-de-comandos-con-el-operador-pipe"><i class="fas fa-link"></i></a>
</h3>
<p>Una de las claves para el flujo de trabajo con las funciones de <strong>dplyr</strong> es el operador <a href="http://r4ds.had.co.nz/pipes.html">‘pipe’</a> <code>%&gt;%</code> (y desde R <code>4.1.0</code> el pipe nativo <code>|&gt;</code>), el cual toma su nombre del pipe de Unix <code>|</code> <span class="citation">(<a href="attr.html#ref-grolemund_r_2016" role="doc-biblioref">Grolemund and Wickham 2016</a>)</span>.
Los pipes permiten un código expresivo: el resultado de una función anterior se convierte en el primer argumento de la siguiente función, lo que permite <em>encadenar</em>.
Esto se ilustra a continuación, en el que sólo se filtran los países de Asia del conjunto de datos <code>world</code>, a continuación se seleccionan dos columnas para crear un subconjunto (<code>name_long</code> y <code>continent</code>) y las cinco primeras filas (resultado no mostrado).</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world7</span> <span class="op">=</span> <span class="va">world</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Asia"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">name_long</span>, <span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<p>El fragmento anterior muestra cómo el operador pipe permite escribir los comandos en un orden claro:
los anteriores van de arriba a abajo (línea por línea) y de izquierda a derecha.
La alternativa a <code>%&gt;%</code> son las llamadas a funciones ‘anidadas,’ que son más difíciles de leer:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world8</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">world</span>, <span class="va">continent</span> <span class="op">==</span> <span class="st">"Asia"</span><span class="op">)</span>,
    <span class="va">name_long</span>, <span class="va">continent</span><span class="op">)</span>,
  <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
</div>
<div id="agregación-de-atributos-vectoriales" class="section level3" number="3.2.3">
<h3>
<span class="header-section-number">3.2.3</span> Agregación de atributos vectoriales<a class="anchor" aria-label="anchor" href="#agregaci%C3%B3n-de-atributos-vectoriales"><i class="fas fa-link"></i></a>
</h3>
<p>
</p>
<p>La agregación implica resumir los datos con una o más “variables de agrupación,” normalmente a partir de columnas del marco de datos que se va a agregar (la agregación geográfica se trata en el siguiente capítulo).
Un ejemplo de agregación de atributos es el cálculo del número de personas por continente a partir de los datos a nivel de país (una fila por país).
El conjunto de datos <code>world</code> contiene los ingredientes necesarios: las columnas <code>pop</code> y <code>continent</code>, la población y la variable de agrupación, respectivamente.
El objetivo es encontrar la suma <code><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html">sum()</a></code> de las poblaciones de los países para cada continente, lo que resulta en un marco de datos más pequeño (la agregación es una forma de reducción de datos y puede ser un paso inicial útil cuando se trabaja con grandes conjuntos de datos).
Esto se puede hacer con la función básica de R <code>agregate()</code> de la siguiente manera:</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world_agg1</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/aggregate.sf.html">aggregate</a></span><span class="op">(</span><span class="va">pop</span> <span class="op">~</span> <span class="va">continent</span>, FUN <span class="op">=</span> <span class="va">sum</span>, data <span class="op">=</span> <span class="va">world</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">world_agg1</span><span class="op">)</span>
<span class="co">#&gt; [1] "data.frame"</span></code></pre></div>
<p>El resultado es un marco de datos no espacial con seis filas, una por continente, y dos columnas que informan del nombre y la población de cada continente (véase la tabla <a href="attr.html#tab:continents">3.2</a> con los resultados de los 3 continentes más poblados).</p>
<p><code><a href="https://r-spatial.github.io/sf/reference/aggregate.sf.html">aggregate()</a></code> es una <a href="https://adv-r.hadley.nz/s3.html#s3-methods">función genérica</a> lo que significa que se comporta de forma diferente en función de lo que se le añada.
<strong>sf</strong> proporciona el método <code><a href="https://r-spatial.github.io/sf/reference/aggregate.sf.html">aggregate.sf()</a></code> que se activa automáticamente cuando <code>x</code> es un objeto <code>sf</code> al que se le proporciona un argumento <code>by</code>:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world_agg2</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/aggregate.sf.html">aggregate</a></span><span class="op">(</span><span class="va">world</span><span class="op">[</span><span class="st">"pop"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">world</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="va">sum</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">world_agg2</span><span class="op">)</span>
<span class="co">#&gt; [1] "sf"         "data.frame"</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">nrow</a></span><span class="op">(</span><span class="va">world_agg2</span><span class="op">)</span>
<span class="co">#&gt; [1] 8</span></code></pre></div>
<p>El resultado es un objeto espacial <code>world_agg2</code> que contiene 8 características que representan los continentes del mundo (y el océano abierto).
<code>group_by() %&gt;% summarize()</code> es el equivalente en <strong>dplyr</strong> de la función <code><a href="https://r-spatial.github.io/sf/reference/aggregate.sf.html">aggregate()</a></code>, con el nombre de la variable proporcionado en la función <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> especificando la variable de agrupación y la información sobre lo que se va a resumir al pasarle la función <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>, como se muestra a continuación:</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world_agg3</span> <span class="op">=</span> <span class="va">world</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html">sum</a></span><span class="op">(</span><span class="va">pop</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>El enfoque puede parecer más complejo, pero tiene ventajas: flexibilidad, legibilidad y control sobre los nuevos nombres de las columnas.
Esta flexibilidad se ilustra en el siguiente comando, que calcula no sólo la población, sino también la superficie y el número de países de cada continente:</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world_agg4</span>  <span class="op">=</span> <span class="va">world</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html">sum</a></span><span class="op">(</span><span class="va">pop</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, `area (sqkm)` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html">sum</a></span><span class="op">(</span><span class="va">area_km2</span><span class="op">)</span>, n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>En el fragmento de código anterior <code>pop</code>, <code>area (sqkm)</code> y <code>n</code> son nombres de columnas en el resultado, y <code><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html">sum()</a></code> y <code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code> eran las funciones de agregación.
Estas funciones de agregación devuelven objetos <code>sf</code> con filas que representan los continentes y geometrías que contienen múltiples polígonos que representan cada masa de tierra e islas asociadas (esto funciona gracias a la operación geométrica “unión,” como se explica en la sección <a href="#geometry-unions"><strong>??</strong></a>).</p>
<p>Combinemos lo que hemos aprendido hasta ahora sobre las funciones de <strong>dplyr</strong>, encadenando varios comandos para resumir datos de atributos sobre todos los países por continente.
El siguiente comando calcula la densidad de población (con <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>), ordena los continentes por el número de países que contienen (con <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">dplyr::arrange()</a></code>), y mantiene sólo los 3 continentes más poblados (con <code><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n()</a></code>), cuyo resultado se presenta en la Tabla <a href="attr.html#tab:continents">3.2</a>):</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world_agg5</span> <span class="op">=</span> <span class="va">world</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                      <span class="co"># aisla la geometría para ganar velocidad</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">pop</span>, <span class="va">continent</span>, <span class="va">area_km2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># crea un subconjunto con las columnas de interés</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                     <span class="co"># agrupa por continente y resume los datos</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>Pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html">sum</a></span><span class="op">(</span><span class="va">pop</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, Area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html">sum</a></span><span class="op">(</span><span class="va">area_km2</span><span class="op">)</span>, N <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Density <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/math-generics.html">round</a></span><span class="op">(</span><span class="va">Pop</span> <span class="op">/</span> <span class="va">Area</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>     <span class="co"># calcula la densidad de población</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span>, wt <span class="op">=</span> <span class="va">Pop</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                  <span class="co"># muestra sólo las 3 primeras filas</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span>                            <span class="co"># ordenar los 3 continentes en orden descendiente</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:continents">TABLE 3.2: </span>The top 3 most populous continents ordered by population density (people per square km).</caption>
<thead><tr class="header">
<th align="left">continent</th>
<th align="right">Pop</th>
<th align="right">Area</th>
<th align="right">N</th>
<th align="right">Density</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Africa</td>
<td align="right">1154946633</td>
<td align="right">29946198</td>
<td align="right">51</td>
<td align="right">39</td>
</tr>
<tr class="even">
<td align="left">Asia</td>
<td align="right">4311408059</td>
<td align="right">31252459</td>
<td align="right">47</td>
<td align="right">138</td>
</tr>
<tr class="odd">
<td align="left">Europe</td>
<td align="right">669036256</td>
<td align="right">23065219</td>
<td align="right">39</td>
<td align="right">29</td>
</tr>
</tbody>
</table></div>
<div class="rmdnote">
More details are provided in the help pages (which can be accessed via <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">?summarize</a></code> and <code>vignette(package = "dplyr")</code> and Chapter 5 of <a href="http://r4ds.had.co.nz/transform.html#grouped-summaries-with-summarize">R for Data Science</a>.
</div>
</div>
<div id="unión-de-atributos-vectoriales" class="section level3" number="3.2.4">
<h3>
<span class="header-section-number">3.2.4</span> Unión de atributos vectoriales<a class="anchor" aria-label="anchor" href="#uni%C3%B3n-de-atributos-vectoriales"><i class="fas fa-link"></i></a>
</h3>
<p>Combinar datos de diferentes fuentes es una tarea frecuente en la preparación de datos.
Las uniones hacen esto combinando tablas basadas en una variable “clave” compartida.
<strong>dplyr</strong> tiene múltiples funciones de unión incluyendo <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> y <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> — véase <code><a href="https://dplyr.tidyverse.org/articles/two-table.html">vignette("two-table")</a></code> para una lista completa.
Estos nombres de funciones siguen las convenciones utilizadas en el lenguaje de las bases de datos <a href="http://r4ds.had.co.nz/relational-data.html">SQL</a> <span class="citation">(<a href="attr.html#ref-grolemund_r_2016" role="doc-biblioref">Grolemund and Wickham 2016, chap. 13</a>)</span>; utilizándolos para unir conjuntos de datos no espaciales a objetos <code>sf</code>.
El objetivo de esta sección es aprender a realizar este tipo de unión.
Las funciones de unión de <strong>dplyr</strong> funcionan igual en los marcos de datos y en los objetos <code>sf</code>, la única diferencia importante es la columna de la lista <code>geometría</code>.
El resultado de las uniones de datos puede ser tanto un objeto <code>sf</code> como un objeto <code>data.frame</code>.
El tipo más común de unión de atributos en datos espaciales toma un objeto <code>sf</code> como primer argumento y le añade columnas de un <code>data.frame</code> especificado como segundo argumento.

</p>
<p>Para demostrar las uniones, combinaremos los datos sobre la producción de café con el conjunto de datos <code>world</code>.
Los datos sobre el café se encuentran en un marco de datos llamado <code>coffee_data</code> del paquete <strong>spData</strong> (véase <code><a href="https://nowosad.github.io/spData/reference/coffee_data.html">?coffee_data</a></code> para más detalles).
<code>coffee_data</code> tiene 3 columnas:
<code>name_long</code> nombra las principales naciones productoras de café; y <code>coffee_production_2016</code> y <code>coffee_production_2017</code> contienen valores estimados de la producción de café en unidades de sacos de 60 kg para cada año.
Un “left join,” que conserva el primer conjunto de datos, combina “world” con “coffee_data”:</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world_coffee</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">world</span>, <span class="va">coffee_data</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "name_long"</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">world_coffee</span><span class="op">)</span>
<span class="co">#&gt; [1] "sf"         "tbl_df"     "tbl"        "data.frame"</span></code></pre></div>
<p>Dado que los conjuntos de datos de entrada comparten una “variable clave” (<code>name_long</code>), la unión ha funcionado sin utilizar el argumento <code>by</code> (véase <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">?left_join</a></code> para más detalles).
El resultado es un objeto <code>sf</code> idéntico al objeto original <code>world</code> pero con dos nuevas variables sobre la producción de café.
Esto puede ser representado como un mapa, tal y como se ilustra en la Figura <a href="attr.html#fig:coffeemap">3.1</a>, generated with the <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code> function below:</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/terra/man/names.html">names</a></span><span class="op">(</span><span class="va">world_coffee</span><span class="op">)</span>
<span class="co">#&gt;  [1] "iso_a2"                 "name_long"              "continent"             </span>
<span class="co">#&gt;  [4] "region_un"              "subregion"              "type"                  </span>
<span class="co">#&gt;  [7] "area_km2"               "pop"                    "lifeExp"               </span>
<span class="co">#&gt; [10] "gdpPercap"              "geom"                   "coffee_production_2016"</span>
<span class="co">#&gt; [13] "coffee_production_2017"</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">world_coffee</span><span class="op">[</span><span class="st">"coffee_production_2017"</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:coffeemap"></span>
<img src="03-atributos_files/figure-html/coffeemap-1.png" alt="Producción mundial de café (en miles de sacos de 60 kg) por país, 2017. Fuente: Organización Internacional del Café." width="100%"><p class="caption">
FIGURE 3.1: Producción mundial de café (en miles de sacos de 60 kg) por país, 2017. Fuente: Organización Internacional del Café.
</p>
</div>
<p>Para que la unión funcione, se debe proporcionar una “variable clave” en ambos conjuntos de datos.
Por defecto <strong>dplyr</strong> utiliza todas las variables con nombres coincidentes.
En este caso, ambos objetos <code>world_coffee</code> y <code>world</code> contenían una variable llamada <code>name_long</code>, lo que explica el mensaje <code>Joining, by = "name_long"</code>.
En la mayoría de los casos en que los nombres de las variables no son iguales. En esos casos tienes dos opciones:</p>
<ol style="list-style-type: decimal">
<li>Cambiar el nombre de la variable clave en uno de los objetos para que coincidan.</li>
<li>Utilizar el argumento <code>by</code> para especificar las variables de unión.</li>
</ol>
<p>Este último enfoque se demuestra a continuación en una versión renombrada de <code>coffee_data</code>:</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coffee_renamed</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="va">coffee_data</span>, nm <span class="op">=</span> <span class="va">name_long</span><span class="op">)</span>
<span class="va">world_coffee2</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">world</span>, <span class="va">coffee_renamed</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>name_long <span class="op">=</span> <span class="st">"nm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Obsérvese que se mantiene el nombre del objeto original, lo que significa que <code>world_coffee</code> y el nuevo objeto <code>world_coffee2</code> son idénticos.
Otra característica del resultado es que tiene el mismo número de filas que el conjunto de datos original.
Aunque sólo hay 47 filas de datos en <code>coffee_data</code>, los 177 registros de países se mantienen intactos en <code>world_coffee</code> y <code>world_coffee2</code>:
Las filas del conjunto de datos original que no coinciden se les asignan valores “NA” para las nuevas variables de producción de café.
¿Y si sólo queremos conservar los países que coinciden con la variable clave?
En ese caso se puede utilizar <code>inner join()</code>:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world_coffee_inner</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">world</span>, <span class="va">coffee_data</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "name_long"</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">nrow</a></span><span class="op">(</span><span class="va">world_coffee_inner</span><span class="op">)</span>
<span class="co">#&gt; [1] 45</span></code></pre></div>
<p>Fíjate en que el resultado de <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> sólo tiene 45 filas frente a las 47 de <code>coffee_data</code>.
¿Qué ha ocurrido con las filas restantes?
Podemos identificar las filas que no coinciden utilizando la función <code><a href="https://generics.r-lib.org/reference/setops.html">setdiff()</a></code> de la siguiente manera:</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="va">coffee_data</span><span class="op">$</span><span class="va">name_long</span>, <span class="va">world</span><span class="op">$</span><span class="va">name_long</span><span class="op">)</span>
<span class="co">#&gt; [1] "Congo, Dem. Rep. of" "Others"</span></code></pre></div>
<p>El resultado muestra que <code>Others</code> representa una fila que no está presente en el conjunto de datos <code>world</code> y en el caso de la “República Democrática del Congo” el nombre
ha sido abreviado, lo que hace que la unión no lo tenga en cuenta.
El siguiente comando utiliza una función de concordancia de palabras (regex) del paquete <strong>stringr</strong> para confirmar qué debería ser <code>Congo, Dem. Rep. of</code>:</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">drc</span> <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_subset.html">str_subset</a></span><span class="op">(</span><span class="va">world</span><span class="op">$</span><span class="va">name_long</span>, <span class="st">"Dem*.+Congo"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "Democratic Republic of the Congo"</span></code></pre></div>
<p>Para solucionar este problema, crearemos una nueva versión de <code>coffee_data</code> y actualizaremos el nombre.
Si se une el marco de datos actualizado con <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code>, se obtiene un resultado con las 46 naciones productoras de café:</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coffee_data</span><span class="op">$</span><span class="va">name_long</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Congo,"</span>, <span class="va">coffee_data</span><span class="op">$</span><span class="va">name_long</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="va">drc</span>
<span class="va">world_coffee_match</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">world</span>, <span class="va">coffee_data</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "name_long"</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">nrow</a></span><span class="op">(</span><span class="va">world_coffee_match</span><span class="op">)</span>
<span class="co">#&gt; [1] 46</span></code></pre></div>
<p>También es posible unir en la dirección contraria: empezar con un conjunto de datos no espaciales y añadir variables de un objeto Simple Features (sf).
Esto se demuestra a continuación, se comienza con el objeto <code>coffee_data</code> y se le añaden variables del conjunto de datos original <code>world</code>.
A diferencia de las uniones anteriores, el resultado <em>no</em> es otro objeto Simple Feature, sino un marco de datos en forma de tibble de <strong>tidyverse</strong>:
El resultado de una unión tiende a coincidir con su primer argumento:</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coffee_world</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">coffee_data</span>, <span class="va">world</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "name_long"</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">coffee_world</span><span class="op">)</span>
<span class="co">#&gt; [1] "tbl_df"     "tbl"        "data.frame"</span></code></pre></div>

<div class="rmdnote">
En la mayoría de los casos, la columna de geometría sólo es útil en un objeto <code>sf</code>.
La columna de geometría sólo puede utilizarse para crear mapas y operaciones espaciales si R “sabe” que es un objeto espacial, definido por un paquete espacial como <strong>sf</strong>.
Afortunadamente, los marcos de datos no espaciales con una columna de lista de geometría (como <code>coffee_world</code>) pueden ser convertidos en un objeto <code>sf</code> de la siguiente manera: <code>st_as_sf(mundo_café)</code>.
</div>
<p>Esta sección cubre la mayoría de los casos de uso de <code>join</code>.
Para más información, recomendamos <span class="citation"><a href="attr.html#ref-grolemund_r_2016" role="doc-biblioref">Grolemund and Wickham</a> (<a href="attr.html#ref-grolemund_r_2016" role="doc-biblioref">2016</a>)</span>, la <a href="https://geocompr.github.io/geocompkg/articles/join.html">‘viñeta’ de join</a> en el paquete <strong>geocompkg</strong> que acompaña este libro, y la documentación del paquete <strong>data.table</strong>.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;
&lt;strong&gt;data.table&lt;/strong&gt; es un paquete de procesamiento de datos de alto rendimiento.
Su aplicación a los datos geográficos se trata en la siguiente entrada de blog: r-spatial.org/r/2017/11/13/perp-performance.html.&lt;/p&gt;"><sup>13</sup></a>
Otro tipo de unión es la unión espacial, que se trata en el siguiente capítulo (Sección <a href="#spatial-joining"><strong>??</strong></a>).</p>
</div>
<div id="vec-attr-creation" class="section level3" number="3.2.5">
<h3>
<span class="header-section-number">3.2.5</span> Creando atributos y eliminando información espacial<a class="anchor" aria-label="anchor" href="#vec-attr-creation"><i class="fas fa-link"></i></a>
</h3>
<p>A menudo, queremos crear una nueva columna basada en columnas ya existentes.
Por ejemplo, queremos calcular la densidad de población de cada país.
Para ello necesitamos dividir una columna de población, aquí <code>pop</code>, por una columna de área, aquí <code>area_km2</code>.
Usando R base, podemos escribir:</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world_new</span> <span class="op">=</span> <span class="va">world</span> <span class="co"># no sobreescribe nuestros datos originales</span>
<span class="va">world_new</span><span class="op">$</span><span class="va">pop_dens</span> <span class="op">=</span> <span class="va">world_new</span><span class="op">$</span><span class="va">pop</span> <span class="op">/</span> <span class="va">world_new</span><span class="op">$</span><span class="va">area_km2</span></code></pre></div>
<p>Alternativamente, podemos utilizar una de las funciones de <strong>dplyr</strong> - <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> o <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute()</a></code>.
La función <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> añade nuevas columnas en la penúltima posición del objeto <code>sf</code> (la última se reserva para la geometría):</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pop_dens <span class="op">=</span> <span class="va">pop</span> <span class="op">/</span> <span class="va">area_km2</span><span class="op">)</span></code></pre></div>
<p>The difference between <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute()</a></code> is that the latter drops all other existing columns (except for the sticky geometry column):</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span><span class="op">(</span>pop_dens <span class="op">=</span> <span class="va">pop</span> <span class="op">/</span> <span class="va">area_km2</span><span class="op">)</span></code></pre></div>
<p><code>unite()</code> from the <strong>tidyr</strong> package (which provides many useful functions for reshaping datasets, including <code>pivot_longer()</code>) pastes together existing columns.
For example, we want to combine the <code>continent</code> and <code>region_un</code> columns into a new column named <code>con_reg</code>.
Additionally, we can define a separator (here: a colon <code>:</code>) which defines how the values of the input columns should be joined, and if the original columns should be removed (here: <code>TRUE</code>):</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world_unite</span> <span class="op">=</span> <span class="va">world</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">unite</span><span class="op">(</span><span class="st">"con_reg"</span>, <span class="va">continent</span><span class="op">:</span><span class="va">region_un</span>, sep <span class="op">=</span> <span class="st">":"</span>, remove <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>The <code>separate()</code> function does the opposite of <code>unite()</code>: it splits one column into multiple columns using either a regular expression or character positions.
This function also comes from the <strong>tidyr</strong> package.</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world_separate</span> <span class="op">=</span> <span class="va">world_unite</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">separate</span><span class="op">(</span><span class="va">con_reg</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"continent"</span>, <span class="st">"region_un"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">":"</span><span class="op">)</span></code></pre></div>
<p>The <strong>dplyr</strong> function <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> and the base R function <code><a href="https://rdrr.io/r/stats/setNames.html">setNames()</a></code> are useful for renaming columns.
The first replaces an old name with a new one.
The following command, for example, renames the lengthy <code>name_long</code> column to simply <code>name</code>:</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">name_long</span><span class="op">)</span></code></pre></div>
<p><code><a href="https://rdrr.io/r/stats/setNames.html">setNames()</a></code> changes all column names at once, and requires a character vector with a name matching each column.
This is illustrated below, which outputs the same <code>world</code> object, but with very short names:</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"i"</span>, <span class="st">"n"</span>, <span class="st">"c"</span>, <span class="st">"r"</span>, <span class="st">"s"</span>, <span class="st">"t"</span>, <span class="st">"a"</span>, <span class="st">"p"</span>, <span class="st">"l"</span>, <span class="st">"gP"</span>, <span class="st">"geom"</span><span class="op">)</span>
<span class="va">world</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">new_names</span><span class="op">)</span></code></pre></div>
<p>It is important to note that attribute data operations preserve the geometry of the simple features.
As mentioned at the outset of the chapter, it can be useful to remove the geometry.
To do this, you have to explicitly remove it.
Hence, an approach such as <code>select(world, -geom)</code> will be unsuccessful and you should instead use <code><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry()</a></code>.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;
&lt;code&gt;st_geometry(world_st) = NULL&lt;/code&gt; also works to remove the geometry from &lt;code&gt;world&lt;/code&gt;, but overwrites the original object.&lt;/p&gt;"><sup>14</sup></a></p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">world_data</span> <span class="op">=</span> <span class="va">world</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">world_data</span><span class="op">)</span>
<span class="co">#&gt; [1] "tbl_df"     "tbl"        "data.frame"</span></code></pre></div>
</div>
</div>
<div id="manipulating-raster-objects" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Manipulating raster objects<a class="anchor" aria-label="anchor" href="#manipulating-raster-objects"><i class="fas fa-link"></i></a>
</h2>
<!--jn-->
<p>In contrast to the vector data model underlying simple features (which represents points, lines and polygons as discrete entities in space), raster data represent continuous surfaces.
This section shows how raster objects work by creating them <em>from scratch</em>, building on Section <a href="#an-introduction-to-terra"><strong>??</strong></a>.
Because of their unique structure, subsetting and other operations on raster datasets work in a different way, as demonstrated in Section <a href="attr.html#raster-subsetting">3.3.1</a>.
</p>
<p>The following code recreates the raster dataset used in Section <a href="spatial-class.html#raster-classes">2.3.4</a>, the result of which is illustrated in Figure <a href="attr.html#fig:cont-raster">3.2</a>.
This demonstrates how the <code><a href="https://rdrr.io/pkg/terra/man/rast.html">rast()</a></code> function works to create an example raster named <code>elev</code> (representing elevations).</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">elev</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html">rast</a></span><span class="op">(</span>nrows <span class="op">=</span> <span class="fl">6</span>, ncols <span class="op">=</span> <span class="fl">6</span>, resolution <span class="op">=</span> <span class="fl">0.5</span>, 
            xmin <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>, xmax <span class="op">=</span> <span class="fl">1.5</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>, ymax <span class="op">=</span> <span class="fl">1.5</span>,
            vals <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">36</span><span class="op">)</span></code></pre></div>
<p>The result is a raster object with 6 rows and 6 columns (specified by the <code>nrow</code> and <code>ncol</code> arguments), and a minimum and maximum spatial extent in x and y direction (<code>xmin</code>, <code>xmax</code>, <code>ymin</code>, <code>ymax</code>).
The <code>vals</code> argument sets the values that each cell contains: numeric data ranging from 1 to 36 in this case.
Raster objects can also contain categorical values of class <code>logical</code> or <code>factor</code> variables in R.
The following code creates a raster representing grain sizes (Figure <a href="attr.html#fig:cont-raster">3.2</a>):</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grain_order</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"clay"</span>, <span class="st">"silt"</span>, <span class="st">"sand"</span><span class="op">)</span>
<span class="va">grain_char</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">grain_order</span>, <span class="fl">36</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">grain_fact</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">grain_char</span>, levels <span class="op">=</span> <span class="va">grain_order</span><span class="op">)</span>
<span class="va">grain</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html">rast</a></span><span class="op">(</span>nrows <span class="op">=</span> <span class="fl">6</span>, ncols <span class="op">=</span> <span class="fl">6</span>, resolution <span class="op">=</span> <span class="fl">0.5</span>, 
             xmin <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>, xmax <span class="op">=</span> <span class="fl">1.5</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>, ymax <span class="op">=</span> <span class="fl">1.5</span>,
             vals <span class="op">=</span> <span class="va">grain_fact</span><span class="op">)</span></code></pre></div>
<p>The raster object stores the corresponding look-up table or “Raster Attribute Table” (RAT) as a list of data frames, which can be viewed with <code>cats(grain)</code> (see <code>?cats()</code> for more information).
Each element of this list is a layer of the raster.
It is also possible to use the function <code><a href="https://rdrr.io/pkg/terra/man/factors.html">levels()</a></code> for retrieving and adding new or replacing existing factor levels:</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html">levels</a></span><span class="op">(</span><span class="va">grain</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html">levels</a></span><span class="op">(</span><span class="va">grain</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, wetness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"wet"</span>, <span class="st">"moist"</span>, <span class="st">"dry"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/factors.html">levels</a></span><span class="op">(</span><span class="va">grain</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] "clay"  "silt"  "sand"  "wet"   "moist" "dry"</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:cont-raster"></span>
<img src="03-atributos_files/figure-html/cont-raster-1.png" alt="Raster datasets with numeric (left) and categorical values (right)." width="100%"><p class="caption">
FIGURE 3.2: Raster datasets with numeric (left) and categorical values (right).
</p>
</div>

<div class="rmdnote">
Categorical raster objects can also store information about the colors associated with each value using a color table.
The color table is a data frame with three (red, green, blue) or four (alpha) columns, where each row relates to one value.
Color tables in <strong>terra</strong> can be viewed or set with the <code><a href="https://rdrr.io/pkg/terra/man/colors.html">coltab()</a></code> function (see <code><a href="https://rdrr.io/pkg/terra/man/colors.html">?coltab</a></code>).
Importantly, saving a raster object with a color table to a file (e.g., GeoTIFF) will also save the color information.
</div>
<div id="raster-subsetting" class="section level3" number="3.3.1">
<h3>
<span class="header-section-number">3.3.1</span> Raster subsetting<a class="anchor" aria-label="anchor" href="#raster-subsetting"><i class="fas fa-link"></i></a>
</h3>
<p>Raster subsetting is done with the base R operator <code>[</code>, which accepts a variety of inputs:
</p>
<ul>
<li>Row-column indexing</li>
<li>Cell IDs</li>
<li>Coordinates (see Section <a href="#spatial-raster-subsetting"><strong>??</strong></a>)</li>
<li>Another spatial object (see Section <a href="#spatial-raster-subsetting"><strong>??</strong></a>)</li>
</ul>
<p>Here, we only show the first two options since these can be considered non-spatial operations.
If we need a spatial object to subset another or the output is a spatial object, we refer to this as spatial subsetting.
Therefore, the latter two options will be shown in the next chapter (see Section <a href="#spatial-raster-subsetting"><strong>??</strong></a>).</p>
<p>The first two subsetting options are demonstrated in the commands below —
both return the value of the top left pixel in the raster object <code>elev</code> (results not shown):</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># row 1, column 1</span>
<span class="va">elev</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>
<span class="co"># cell ID 1</span>
<span class="va">elev</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></code></pre></div>
<p>Subsetting of multi-layered raster objects will return the cell value(s) for each layer.
For example, <code>c(elev, grain)[1]</code> returns a data frame with one row and two columns — one for each layer.
To extract all values or complete rows, you can also use <code><a href="https://rdrr.io/pkg/terra/man/values.html">values()</a></code>.</p>
<p>Cell values can be modified by overwriting existing values in conjunction with a subsetting operation.
The following code chunk, for example, sets the upper left cell of <code>elev</code> to 0 (results not shown):</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">elev</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0</span>
<span class="va">elev</span><span class="op">[</span><span class="op">]</span></code></pre></div>
<p>Leaving the square brackets empty is a shortcut version of <code><a href="https://rdrr.io/pkg/terra/man/values.html">values()</a></code> for retrieving all values of a raster.
Multiple cells can also be modified in this way:</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">elev</span><span class="op">[</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0</span></code></pre></div>
<p>Replacing values of multilayered rasters can be done with a matrix with as many columns as layers and rows as replaceable cells (results not shown):</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">two_layers</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="va">grain</span>, <span class="va">elev</span><span class="op">)</span> 
<span class="va">two_layers</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="va">two_layers</span><span class="op">[</span><span class="op">]</span></code></pre></div>
</div>
<div id="summarizing-raster-objects" class="section level3" number="3.3.2">
<h3>
<span class="header-section-number">3.3.2</span> Summarizing raster objects<a class="anchor" aria-label="anchor" href="#summarizing-raster-objects"><i class="fas fa-link"></i></a>
</h3>
<p><strong>terra</strong> contains functions for extracting descriptive statistics for entire rasters.
Printing a raster object to the console by typing its name returns minimum and maximum values of a raster.
<code><a href="https://rdrr.io/pkg/terra/man/summary.html">summary()</a></code> provides common descriptive statistics – minimum, maximum, quartiles and number of <code>NA</code>s for continuous rasters and a number of cells of each class for categorical rasters.
Further summary operations such as the standard deviation (see below) or custom summary statistics can be calculated with <code><a href="https://rdrr.io/pkg/terra/man/global.html">global()</a></code>.
</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/terra/man/global.html">global</a></span><span class="op">(</span><span class="va">elev</span>, <span class="va">sd</span><span class="op">)</span></code></pre></div>

<div class="rmdnote">
If you provide the <code><a href="https://rdrr.io/pkg/terra/man/summary.html">summary()</a></code> and <code><a href="https://rdrr.io/pkg/terra/man/global.html">global()</a></code> functions with a multi-layered raster object, they will summarize each layer separately, as can be illustrated by running: <code>summary(c(elev, grain))</code>.
</div>
<p>Additionally, the <code><a href="https://rdrr.io/pkg/terra/man/freq.html">freq()</a></code> function allows to get the frequency table of categorical values.</p>
<p>Raster value statistics can be visualized in a variety of ways.
Specific functions such as <code><a href="https://rdrr.io/pkg/terra/man/boxplot.html">boxplot()</a></code>, <code><a href="https://rdrr.io/pkg/terra/man/density.html">density()</a></code>, <code><a href="https://rdrr.io/pkg/terra/man/hist.html">hist()</a></code> and <code><a href="https://rdrr.io/pkg/terra/man/pairs.html">pairs()</a></code> work also with raster objects, as demonstrated in the histogram created with the command below (not shown):</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/terra/man/hist.html">hist</a></span><span class="op">(</span><span class="va">elev</span><span class="op">)</span></code></pre></div>
<p>In case the desired visualization function does not work with raster objects, one can extract the raster data to be plotted with the help of <code><a href="https://rdrr.io/pkg/terra/man/values.html">values()</a></code> (Section <a href="attr.html#raster-subsetting">3.3.1</a>).
</p>
<p>Descriptive raster statistics belong to the so-called global raster operations.
These and other typical raster processing operations are part of the map algebra scheme, which are covered in the next chapter (Section <a href="#map-algebra"><strong>??</strong></a>).</p>
<div class="rmdnote">
<p>
Some function names clash between packages (e.g., a function with the name <code><a href="https://rdrr.io/pkg/terra/man/extract.html">extract()</a></code> exist in both <strong>terra</strong> and <strong>tidyr</strong> packages). In addition to not loading packages by referring to functions verbosely (e.g., <code><a href="https://tidyr.tidyverse.org/reference/extract.html">tidyr::extract()</a></code>), another way to prevent function names clashes is by unloading the offending package with <code><a href="https://rdrr.io/r/base/detach.html">detach()</a></code>. The following command, for example, unloads the <strong>terra</strong> package (this can also be done in the <em>package</em> tab which resides by default in the right-bottom pane in RStudio): <code>detach(“package:terra,” unload = TRUE, force = TRUE)</code>. The <code>force</code> argument makes sure that the package will be detached even if other packages depend on it. This, however, may lead to a restricted usability of packages depending on the detached package, and is therefore not recommended.
</p>
</div>
</div>
</div>
<div id="ejercicios-1" class="section level2" number="3.4">
<h2>
<span class="header-section-number">3.4</span> Ejercicios<a class="anchor" aria-label="anchor" href="#ejercicios-1"><i class="fas fa-link"></i></a>
</h2>
<p>Para estos ejercicios utilizaremos los conjuntos de datos <code>us_states</code> y <code>us_states_df</code> del paquete <strong>spData</strong>.
Antes de realizar estos ejercicios, deberás haber añadido este paquete y los otros utilizados en el capítulo de operaciones con atributos (<strong>sf</strong>, <strong>dplyr</strong>, <strong>terra</strong>) con comandos como <code><a href="https://nowosad.github.io/spData/">library(spData)</a></code>.</p>
<p><code>us_states</code> es un objeto espacial (de clase <code>sf</code>), que contiene la geometría y algunos atributos (incluyendo el nombre, la región, el área y la población) de los estados contiguos de Estados Unidos.
El objeto <code>us_states_df</code> es un marco de datos (de la clase <code>data.frame</code>) que contiene el nombre y variables adicionales (incluyendo la renta media y el nivel de pobreza, para los años 2010 y 2015) de los estados de EE.UU., incluyendo Alaska, Hawaii y Puerto Rico.
Los datos proceden de la Oficina del Censo de los Estados Unidos, y están documentados en “us_states” y “us_states_df.”</p>
<p>E1. Crea un nuevo objeto llamado <code>us_states_name</code> que contenga sólo la columna <code>NAME</code> del objeto <code>us_states</code> utilizando la sintaxis de R base (<code>[</code>) o tidyverse (<code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>).
¿Cuál es la clase del nuevo objeto y qué lo hace geográfico?</p>
<p>E2. Selecciona las columnas del objeto <code>us_states</code> que contienen datos de población.
Obtén el mismo resultado utilizando un comando diferente (bonus: intenta encontrar tres formas de obtener el mismo resultado).
Sugerencia: intenta utilizar funciones de ayuda, como <code>contains</code> o <code>starts_with</code> de <strong>dplyr</strong> (ver <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">?contains</a></code>).</p>
<p>E3. Encuentra todos los estados con las siguientes características (bonus: encuéntralos <em>y</em> grafícalos):</p>
<ul>
<li>Pertenecen a la región del Medio Oeste.</li>
<li>Pertenecen a la región Oeste, tienen una superficie inferior a 250.000 km<sup>2</sup><em>y</em> en 2015 una población superior a 5.000.000 de habitantes (pista: puede que tengas que utilizar la función <code><a href="https://rdrr.io/pkg/units/man/units.html">units::set_units()</a></code> o <code><a href="https://rdrr.io/pkg/terra/man/catalyze.html">as.numeric()</a></code>).</li>
<li>Pertenecen a la región Sur, tienen una superficie superior a 150.000 km<sup>2</sup> o una población total en 2015 superior a 7.000.000 de residentes.</li>
</ul>
<p>E4. ¿Cuál fue la población total en 2015 en el conjunto de datos <code>us_states</code>?
¿Cuál fue la población total mínima y máxima en 2015?</p>
<p>E5. ¿Cuántos estados hay en cada región?</p>
<p>E6. ¿Cuál fue la población total mínima y máxima en 2015 en cada región?
¿Cuál fue la población total en 2015 en cada región?</p>
<p>E7. Añade las variables de <code>us_states_df</code> a <code>us_states</code>, y crea un nuevo objeto llamado <code>us_states_stats</code>.
¿Qué función has utilizado y por qué?
¿Qué variable es la clave en ambos conjuntos de datos?
¿Cuál es la clase del nuevo objeto?</p>
<p>E8. <code>us_states_df</code> tiene dos filas más que <code>us_states</code>.
¿Cómo puedes encontrarlas? (pista: intenta utilizar la función <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">dplyr::anti_join()</a></code>)</p>
<p>E9. ¿Cuál era la densidad de población en 2015 en cada estado?
¿Cuál era la densidad de población en cada estado en 2010?</p>
<p>E10. ¿Cuánto ha cambiado la densidad de población entre 2010 y 2015 en cada estado?
Calcula el cambio en porcentajes y crea un mapa que lo muestre.</p>
<p>E11. Cambia los nombres de las columnas en <code>us_states</code> a minúsculas. (Sugerencia: las funciones - <code><a href="https://rdrr.io/r/base/chartr.html">tolower()</a></code> y <code><a href="https://rdrr.io/r/base/colnames.html">colnames()</a></code> pueden ayudar).</p>
<p>E12. Usando <code>us_states</code> y <code>us_states_df</code> crea un nuevo objeto llamado <code>us_states_sel</code>.
El nuevo objeto debe tener sólo dos variables - <code>median_income_15</code> y <code>geometry</code>.
Cambia el nombre de la columna <code>median_income_15</code> por <code>Income</code>.</p>
<p>E13. Calcula la variación del número de residentes que viven por debajo del nivel de pobreza entre 2010 y 2015 para cada estado. (Sugerencia: Consulta ?us_states_df para ver la documentación sobre las columnas relacionadas con el nivel de pobreza).
Bonus: Calcula el cambio en el <em>porcentaje</em> de residentes que viven por debajo del nivel de pobreza en cada estado.</p>
<p>E14. ¿Cuál fue el número mínimo, medio y máximo de personas que viven por debajo del umbral de la pobreza en 2015 en cada región?
Bonus: ¿Cuál es la región con el mayor aumento de personas que viven por debajo del umbral de la pobreza?</p>
<p>E15. Crea un raster desde cero con nueve filas y columnas y una resolución de 0,5 grados decimales (WGS84).
Rellénalo con números aleatorios.
Extrae los valores de las cuatro celdas de las esquinas.</p>
<p>E16. ¿Cuál es la clase más común de nuestro ejemplo de raster <code>grain</code>? (pista: <code><a href="https://rdrr.io/pkg/terra/man/modal.html">modal()</a></code>)</p>
<p>E17. Traza el histograma y el boxplot del raster <code>data(dem, package = "spDataLarge")</code>.</p>

<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-akima_akima_2016" class="csl-entry">
Akima, Hiroshi, and Albrecht Gebhardt. 2016. <em>Akima: <span>Interpolation</span> of <span>Irregularly</span> and <span>Regularly Spaced Data</span></em>.
</div>
<div id="ref-baddeley_spatial_2015" class="csl-entry">
Baddeley, Adrian, Ege Rubak, and Rolf Turner. 2015. <em>Spatial Point Patterns: Methodology and Applications with <span>R</span></em>. <span>CRC Press</span>.
</div>
<div id="ref-bivand_more_2001" class="csl-entry">
Bivand, Roger. 2001. <span>“More on <span>Spatial Data Analysis</span>.”</span> <em>R News</em> 1 (3): 13–17.
</div>
<div id="ref-hornik_approaches_2003" class="csl-entry">
———. 2003. <span>“Approaches to <span>Classes</span> for <span>Spatial Data</span> in <span>R</span>.”</span> In <em>Proceedings of <span>DSC</span></em>, edited by Kurt Hornik, Friedrich Leisch, and Achim Zeileis.
</div>
<div id="ref-bivand_rgrass7_2016" class="csl-entry">
———. 2016a. <em>Rgrass7: <span>Interface Between GRASS</span> 7 <span>Geographical Information System</span> and <span>R</span></em>.
</div>
<div id="ref-bivand_spgrass6_2016" class="csl-entry">
———. 2016b. <em>Spgrass6: <span>Interface</span> Between <span>GRASS</span> 6 and <span>R</span></em>.
</div>
<div id="ref-bivand_spdep_2017" class="csl-entry">
———. 2017. <em>Spdep: <span>Spatial Dependence</span>: <span>Weighting Schemes</span>, <span>Statistics</span> and <span>Models</span></em>.
</div>
<div id="ref-bivand_using_2000" class="csl-entry">
Bivand, Roger S. 2000. <span>“Using the <span>R</span> Statistical Data Analysis Language on <span>GRASS</span> 5.0 <span>GIS</span> Database Files.”</span> <em>Computers &amp; Geosciences</em> 26 (9): 1043–52. <a href="https://doi.org/10.1016/S0098-3004(00)00057-1">https://doi.org/10.1016/S0098-3004(00)00057-1</a>.
</div>
<div id="ref-bivand_implementing_2000" class="csl-entry">
Bivand, Roger, and Albrecht Gebhardt. 2000. <span>“Implementing Functions for Spatial Statistical Analysis Using the Language.”</span> <em>Journal of Geographical Systems</em> 2 (3): 307–17. <a href="https://doi.org/10.1007/PL00011460">https://doi.org/10.1007/PL00011460</a>.
</div>
<div id="ref-R-rgdal" class="csl-entry">
Bivand, Roger, Tim Keitt, and Barry Rowlingson. 2018. <em>Rgdal: Bindings for the ’Geospatial’ Data Abstraction Library</em>. <a href="https://CRAN.R-project.org/package=rgdal">https://CRAN.R-project.org/package=rgdal</a>.
</div>
<div id="ref-bivand_maptools_2017" class="csl-entry">
Bivand, Roger, and Nicholas Lewin-Koh. 2017. <em>Maptools: <span>Tools</span> for <span>Reading</span> and <span>Handling Spatial Objects</span></em>.
</div>
<div id="ref-bivand_open_2000" class="csl-entry">
Bivand, Roger, and Markus Neteler. 2000. <span>“Open Source Geocomputation: Using the <span>R</span> Data Analysis Language Integrated with <span>GRASS GIS</span> and <span>PostgreSQL</span> Data Base Systems.”</span> In <em>Proceedings of the 5th <span>International Conference</span> on <span>GeoComputation</span></em>, edited by Markus Neteler and Roger S. Bivand.
</div>
<div id="ref-bivand_applied_2013" class="csl-entry">
Bivand, Roger, Edzer J Pebesma, and Virgilio Gómez-Rubio. 2013. <em>Applied Spatial Data Analysis with <span>R</span></em>. Vol. 747248717. <span>Springer</span>.
</div>
<div id="ref-R-rgeos" class="csl-entry">
Bivand, Roger, and Colin Rundel. 2018. <em>Rgeos: Interface to Geometry Engine - Open Source (’GEOS’)</em>. <a href="https://CRAN.R-project.org/package=rgeos">https://CRAN.R-project.org/package=rgeos</a>.
</div>
<div id="ref-brenning_arcgis_2012" class="csl-entry">
Brenning, Alexander. 2012. <em><span>ArcGIS Geoprocessing</span> in <span>R</span> via <span>Python</span></em>.
</div>
<div id="ref-R-RSAGA" class="csl-entry">
Brenning, Alexander, Donovan Bangs, and Marc Becker. 2018. <em>RSAGA: SAGA Geoprocessing and Terrain Analysis</em>. <a href="https://CRAN.R-project.org/package=RSAGA">https://CRAN.R-project.org/package=RSAGA</a>.
</div>
<div id="ref-brzustowicz_data_2017" class="csl-entry">
Brzustowicz, Michael R. 2017. <em>Data Science with <span>Java</span>: [Practical Methods for Scientists and Engineers]</em>. First. <span>Beijing Boston Farnham</span>: <span>OReilly</span>.
</div>
<div id="ref-calenge_package_2006" class="csl-entry">
Calenge, C. 2006. <span>“The Package Adehabitat for the <span>R</span> Software: Tool for the Analysis of Space and Habitat Use by Animals.”</span> <em>Ecological Modelling</em> 197: 1035. <a href="https://doi.org/10.1016/j.ecolmodel.2006.03.017">https://doi.org/10.1016/j.ecolmodel.2006.03.017</a>.
</div>
<div id="ref-chambers_extending_2016" class="csl-entry">
Chambers, John M. 2016. <em>Extending <span>R</span></em>. <span>CRC Press</span>.
</div>
<div id="ref-coppock_history_1991" class="csl-entry">
Coppock, J Terry, and David W Rhind. 1991. <span>“The History of <span>GIS</span>.”</span> <em>Geographical Information Systems: Principles and Applications, Vol. 1.</em> 1 (1): 21–43.
</div>
<div id="ref-eddelbuettel_extending_2018" class="csl-entry">
Eddelbuettel, Dirk, and James Joseph Balamuta. 2018. <span>“Extending <span>R</span> with <span>C</span>++: <span>A Brief Introduction</span> to <span>Rcpp</span>.”</span> <em>The American Statistician</em> 72 (1): 28–36. <a href="https://doi.org/gdg3fb">https://doi.org/gdg3fb</a>.
</div>
<div id="ref-garrard_geoprocessing_2016" class="csl-entry">
Garrard, Chris. 2016. <em>Geoprocessing with <span>Python</span></em>. <span>Shelter Island, NY</span>: <span>Manning Publications</span>.
</div>
<div id="ref-gillespie_efficient_2016" class="csl-entry">
Gillespie, Colin, and Robin Lovelace. 2016. <em>Efficient <span>R Programming</span>: <span>A Practical Guide</span> to <span>Smarter Programming</span></em>. <span>O’Reilly Media</span>.
</div>
<div id="ref-grolemund_r_2016" class="csl-entry">
Grolemund, Garrett, and Hadley Wickham. 2016. <em>R for <span>Data Science</span></em>. <span>O’Reilly Media</span>.
</div>
<div id="ref-hijmans_geosphere_2016" class="csl-entry">
Hijmans, Robert J. 2016. <em>Geosphere: <span>Spherical Trigonometry</span></em>.
</div>
<div id="ref-R-raster" class="csl-entry">
———. 2017. <em>Raster: Geographic Data Analysis and Modeling</em>. <a href="https://CRAN.R-project.org/package=raster">https://CRAN.R-project.org/package=raster</a>.
</div>
<div id="ref-jr_geor_2016" class="csl-entry">
Jr, Paulo J. Ribeiro, and Peter J. Diggle. 2016. <em><span class="nocase">geoR</span>: <span>Analysis</span> of <span>Geostatistical Data</span></em>.
</div>
<div id="ref-kahle_ggmap_2013" class="csl-entry">
Kahle, D, and Hadley Wickham. 2013. <span>“Ggmap: <span>Spatial Visualization</span> with Ggplot2.”</span> <em>The R Journal</em> 5: 144–61. <a href="https://doi.org/10.32614/RJ-2013-014">https://doi.org/10.32614/RJ-2013-014</a>.
</div>
<div id="ref-lamigueiro_displaying_2018" class="csl-entry">
Lamigueiro, Oscar Perpinan. 2018. <em>Displaying <span>Time Series</span>, <span>Spatial</span>, and <span>Space</span>-<span>Time Data</span> with <span>R</span></em>. Second. <span>Boca Raton</span>: <span>Chapman and Hall/CRC</span>.
</div>
<div id="ref-livingstone_geographical_1992" class="csl-entry">
Livingstone, David N. 1992. <em>The <span>Geographical Tradition</span>: <span>Episodes</span> in the <span>History</span> of a <span>Contested Enterprise</span></em>. <span>Oxford, UK ; Cambridge, USA</span>: <span>John Wiley &amp; Sons Ltd</span>.
</div>
<div id="ref-longley_geographic_2015" class="csl-entry">
Longley, Paul. 2015. <em>Geographic Information Science &amp; Systems</em>. Fourth edition. <span>Hoboken, NJ</span>: <span>Wiley</span>.
</div>
<div id="ref-longley_geocomputation_1998" class="csl-entry">
Longley, Paul A., Sue M. Brooks, Rachael McDonnell, and Bill MacMillan, eds. 1998. <em>Geocomputation: <span>A Primer</span></em>. <span>Chichester, Eng. ; New York</span>: <span>Wiley</span>.
</div>
<div id="ref-majure_sgeostat_2016" class="csl-entry">
Majure, James J., and Albrecht Gebhardt. 2016. <em>Sgeostat: <span>An Object</span>-<span>Oriented Framework</span> for <span>Geostatistical Modeling</span> in <span>S</span>+</em>.
</div>
<div id="ref-maling_coordinate_1992" class="csl-entry">
Maling, D. H. 1992. <em>Coordinate Systems and Map Projections</em>. Second. <span>Oxford ; New York</span>: <span>Pergamon Press</span>.
</div>
<div id="ref-muenchow_rqgis:_2017" class="csl-entry">
Muenchow, Jannes, Patrick Schratz, and Alexander Brenning. 2017. <span>“<span>RQGIS</span>: <span>Integrating R</span> with <span>QGIS</span> for Statistical Geocomputing.”</span> <em>The R Journal</em> 9 (2): 409–28. <a href="https://doi.org/gf3d48">https://doi.org/gf3d48</a>.
</div>
<div id="ref-neteler_open_2008" class="csl-entry">
Neteler, Markus, and Helena Mitasova. 2008. <em>Open Source <span>GIS</span>: A <span>GRASS GIS</span> Approach</em>. Third. <span>New York, NY</span>: <span>Springer</span>.
</div>
<div id="ref-openshaw_geocomputation_2000" class="csl-entry">
Openshaw, Stan, and Robert J. Abrahart, eds. 2000. <em>Geocomputation</em>. <span>London ; New York</span>: <span>CRC Press</span>.
</div>
<div id="ref-pebesma_simple_2018" class="csl-entry">
Pebesma, Edzer. 2018. <span>“Simple Features for <span>R</span>: <span>Standardized</span> Support for Spatial Vector Data.”</span> <em>The R Journal</em>. <a href="https://doi.org/gf2ztt">https://doi.org/gf2ztt</a>.
</div>
<div id="ref-pebesma_classes_2005" class="csl-entry">
Pebesma, Edzer J, and Roger S Bivand. 2005. <span>“Classes and Methods for Spatial Data in <span>R</span>.”</span> <em>R News</em> 5 (2): 9–13.
</div>
<div id="ref-R-sp" class="csl-entry">
Pebesma, Edzer, and Roger Bivand. 2018. <em>Sp: Classes and Methods for Spatial Data</em>. <a href="https://CRAN.R-project.org/package=sp">https://CRAN.R-project.org/package=sp</a>.
</div>
<div id="ref-pebesma_spatial_2022" class="csl-entry">
———. 2022. <em>Spatial <span>Data Science</span> with Applications in <span>R</span></em>.
</div>
<div id="ref-R-gstat" class="csl-entry">
Pebesma, Edzer, and Benedikt Graeler. 2018. <em>Gstat: Spatial and Spatio-Temporal Geostatistical Modelling, Prediction and Simulation</em>. <a href="https://CRAN.R-project.org/package=gstat">https://CRAN.R-project.org/package=gstat</a>.
</div>
<div id="ref-pebesma_measurement_2016" class="csl-entry">
Pebesma, Edzer, Thomas Mailund, and James Hiebert. 2016. <span>“Measurement <span>Units</span> in <span>R</span>.”</span> <em>The R Journal</em> 8 (2): 486–94. <a href="https://doi.org/gkb5pd">https://doi.org/gkb5pd</a>.
</div>
<div id="ref-pebesma_r_2012" class="csl-entry">
Pebesma, Edzer, Daniel Nüst, and Roger Bivand. 2012. <span>“The <span>R</span> Software Environment in Reproducible Geoscientific Research.”</span> <em>Eos, Transactions American Geophysical Union</em> 93 (16): 163–63. <a href="https://doi.org/gd8djc">https://doi.org/gd8djc</a>.
</div>
<div id="ref-ripley_spatial_2001" class="csl-entry">
Ripley, Brian D. 2001. <span>“Spatial <span>Statistics</span> in <span>R</span>.”</span> <em>R News</em> 1 (2): 14–15.
</div>
<div id="ref-rowlingson_splancs_1993" class="csl-entry">
Rowlingson, B. S, and P. J Diggle. 1993. <span>“Splancs: <span>Spatial</span> Point Pattern Analysis Code in <span>S</span>-Plus.”</span> <em>Computers &amp; Geosciences</em> 19 (5): 627–55. <a href="https://doi.org/dvzffd">https://doi.org/dvzffd</a>.
</div>
<div id="ref-rowlingson_rasp:_2003" class="csl-entry">
Rowlingson, Barry, Adrian Baddeley, Rolf Turner, and Peter Diggle. 2003. <span>“Rasp: <span>A Package</span> for <span>Spatial Statistics</span>.”</span> In <em>Proceedings of the 3rd <span>International Workshop</span> on <span>Distributed Statistical Computing</span></em>, edited by Kurt Hornik.
</div>
<div id="ref-rowlingson_splancs_2017" class="csl-entry">
Rowlingson, Barry, and Peter Diggle. 2017. <em>Splancs: <span>Spatial</span> and <span>Space</span>-<span>Time Point Pattern Analysis</span></em>.
</div>
<div id="ref-sherman_desktop_2008" class="csl-entry">
Sherman, Gary. 2008. <em>Desktop <span>GIS</span>: <span>Mapping</span> the <span>Planet</span> with <span>Open Source Tools</span></em>. <span>Pragmatic Bookshelf</span>.
</div>
<div id="ref-talbert_ancient_2014" class="csl-entry">
Talbert, Richard J. A. 2014. <em>Ancient <span>Perspectives</span>: <span>Maps</span> and <span>Their Place</span> in <span>Mesopotamia</span>, <span>Egypt</span>, <span>Greece</span>, and <span>Rome</span></em>. <span>University of Chicago Press</span>.
</div>
<div id="ref-tennekes_elegant_2022" class="csl-entry">
Tennekes, Martijn, and Jakub Nowosad. 2022. <em>Elegant and Informative Maps with Tmap</em>.
</div>
<div id="ref-theeconomist_autonomous_2016" class="csl-entry">
The Economist. 2016. <span>“The Autonomous Car’s Reality Check.”</span> <em>The Economist</em>.
</div>
<div id="ref-venables_modern_2002" class="csl-entry">
Venables, W. N., and B. D. Ripley. 2002. <em>Modern <span>Applied Statistics</span> with <span>S</span></em>. Fourth. <span>New York</span>: <span>Springer</span>.
</div>
<div id="ref-venables_introduction_2017" class="csl-entry">
Venables, W. N., D. M. Smith, and R Core Team. 2017. <em>An <span>Introduction</span> to <span>R</span>. <span>Notes</span> on <span>R</span>: <span>A Programming Environment</span> for <span>Data Analysis</span> and <span>Graphics</span></em>.
</div>
<div id="ref-wickham_advanced_2014" class="csl-entry">
Wickham, Hadley. 2014. <em>Advanced <span>R</span></em>. <span>CRC Press</span>.
</div>
<div id="ref-wulf_invention_2015" class="csl-entry">
Wulf, Andrea. 2015. <em>The Invention of Nature: <span>Alexander</span> von <span>Humboldt</span>’s New World</em>. <span>New York</span>: <span>Alfred A. Knopf</span>.
</div>
</div>
</div>
</div>








































  <div class="chapter-nav">
<div class="prev"><a href="spatial-class.html"><span class="header-section-number">2</span> Datos geográficos en R</a></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#attr"><span class="header-section-number">3</span> Operaciones de datos de atributos</a></li>
<li><a class="nav-link" href="#prerrequisitos-1">Prerrequisitos</a></li>
<li><a class="nav-link" href="#introducci%C3%B3n"><span class="header-section-number">3.1</span> Introducción</a></li>
<li>
<a class="nav-link" href="#manipulaci%C3%B3n-de-atributos-vectoriales"><span class="header-section-number">3.2</span> Manipulación de atributos vectoriales</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#subconjuntos-de-atributos-vectoriales"><span class="header-section-number">3.2.1</span> Subconjuntos de atributos vectoriales</a></li>
<li><a class="nav-link" href="#encadenamiento-de-comandos-con-el-operador-pipe"><span class="header-section-number">3.2.2</span> Encadenamiento de comandos con el operador pipe</a></li>
<li><a class="nav-link" href="#agregaci%C3%B3n-de-atributos-vectoriales"><span class="header-section-number">3.2.3</span> Agregación de atributos vectoriales</a></li>
<li><a class="nav-link" href="#uni%C3%B3n-de-atributos-vectoriales"><span class="header-section-number">3.2.4</span> Unión de atributos vectoriales</a></li>
<li><a class="nav-link" href="#vec-attr-creation"><span class="header-section-number">3.2.5</span> Creando atributos y eliminando información espacial</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#manipulating-raster-objects"><span class="header-section-number">3.3</span> Manipulating raster objects</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#raster-subsetting"><span class="header-section-number">3.3.1</span> Raster subsetting</a></li>
<li><a class="nav-link" href="#summarizing-raster-objects"><span class="header-section-number">3.3.2</span> Summarizing raster objects</a></li>
</ul>
</li>
<li><a class="nav-link" href="#ejercicios-1"><span class="header-section-number">3.4</span> Ejercicios</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/geocompr/es/blob/main/03-atributos.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/geocompr/es/edit/main/03-atributos.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Geocomputación con R</strong>" was written by Robin Lovelace, Jakub Nowosad, Jannes Muenchow. It was last built on 2022-02-02.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
